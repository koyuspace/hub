---
import Layout from '../layouts/Layout.astro';
import Service from '../components/service.astro';
import Navigation from '../components/navigation.vue';
import data from '../data/data.json';
const users = data.users;
const services = data.services;

let resolveUrl = (u = {url: undefined}, s = "") => {
	if (u.url === undefined) {
		if (s === "gemini") {
			return `gemini://koyu.space/${users[Astro.request.url.split("?acc=")[1]].gemini}/`;
		} else {
			return `https://${s}.koyu.space`;
		}
	} else {
		return u.url;
	}
}

let resolveIcon = (s = undefined) => {
	if (services[s].icon === undefined) {
		return s;
	} else {
		return services[s].icon;
	}
}

let resolveAcc = (s = undefined) => {
	if (users[s] === undefined) {
		return "default";
	} else {
		return s;
	}
}
---

<script>
	let username = localStorage.getItem("username").replace(/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g, '');
	const emojis = JSON.parse(localStorage.getItem("emojis"));
	emojis.forEach(emoji => {
		username = username.replaceAll(`:${emoji.shortcode}: `, "").replaceAll(` :${emoji.shortcode}: `, "").replaceAll(`:${emoji.shortcode}:`, "").replaceAll(` :${emoji.shortcode}:`, "");
	});
	username = username+"%%%";
	username = username.replaceAll(" ", "").replaceAll("%%%", "");
	document.getElementById("name").innerHTML = username;
</script>

<Navigation />
<Layout>
	<main>
		<h1>Welcome <span id="name" />!</h1>
		<p>These are your services</p>
		<span id="services">
			{users[`${Astro.request.url.split("?acc=")[1]}`]["services"].map((service) => (
					<Service
						url={resolveUrl(services[service], service)}
						title={services[service]["title"]}
						icon={resolveIcon(service)}
					/>
			))}
		</span>
	</main>
</Layout>