---
import Layout from '../layouts/Layout.astro';
import Service from '../components/service.astro';
import data from '../data/data.json';
const users = data.users;
const services = data.services;

let resolveUrl = (u = {url: undefined}, s = "") => {
	if (u.url === undefined) {
		if (s === "gemini") {
			return `gemini://koyu.space/${users[Astro.request.url.split("?acc=")[1]].gemini}/`;
		} else {
			return `https://${s}.koyu.space`;
		}
	} else {
		return u.url;
	}
}

let resolveIcon = (s = undefined) => {
	if (services[s].icon === undefined) {
		return s;
	} else {
		return services[s].icon;
	}
}

let resolveAcc = (s = undefined) => {
	if (users[s] === undefined) {
		return "default";
	} else {
		return s;
	}
}
---

<script src="../ts/username.ts"></script>
<script src="../ts/navigation.ts"></script>

<Layout>
	<nav>
		<ul>
			<li><a href="/"><i class="fa fa-home" aria-hidden="true" /></a></li>
			<div class="right">
				<li class="except"><a href="https://koyu.space/settings/profile" target="_blank"><img id="avatar" height="36"></a></li>
				<li><a href="#" id="logout"><i class="fa fa-sign-out" aria-hidden="true" /></a></li>
			</div>
		</ul>
	</nav>
	<main>
		<h1>Welcome <span id="name" />!</h1>
		<p>These are your services</p>
		<span id="services">
			{users[`${Astro.request.url.split("?acc=")[1]}`]["services"].map((service) => (
					<Service
						url={resolveUrl(services[service], service)}
						title={services[service]["title"]}
						icon={resolveIcon(service)}
					/>
			))}
		</span>
	</main>
</Layout>